---
title: "Rotavirus "
author: ""
date: ""
output: html_document
---
   
```{r include=FALSE}
source("librerie.R")
dati <- read_excel("data/Dati epidemiogici RV_2016-2019-070621.xlsx")

dt <- dati %>% 
  mutate( nconf = str_remove_all(nconf, " "),
          nconf = str_c(year, nconf), 
    codaz = str_to_upper(codaz), 
         codaz = gsub("[[:punct:][:blank:]]","", codaz), 
         ageclass = str_remove(ageclass, "Suino"), 
         prelievo = str_c(day, "-", month, "-", year), 
         dtprelievo = dmy(prelievo), 
         Year = year(dtprelievo), 
         Month = month(dtprelievo), 
         Week = week(dtprelievo), 
         rva = ifelse(RVA == "P", "RVA", 0),
         rvb = ifelse(RVB == "P", "RVB", 0), 
         rvc = ifelse(RVC == "P", "RVC", 0), 
         rvh = ifelse(RVH == "P", "RVH", 0),
         rv = ifelse(RV == "P", "RV", 0), 
         pedv = ifelse(PEDV == "P", "PEDV", 0),
         coli = ifelse(ecoli == "P", "EColi", 0), 
         lawsonia = ifelse(Lawsonia == "P", "Lawsonia", 0), 
         brachyod = ifelse(Brachyspira_hyod == "P", "Brachyod", 0),
         brachypil = ifelse(Brachyspira_pilos == "P", "Brachypil", 0), 
         clperfr = ifelse(Clperfr == "P", "Clperf", 0),
         cldiff = ifelse(Cldiff == "P", "Cldiff", 0))
```


# Guarda i dati

```{r fig.height=8, fig.width=10, message=FALSE, warning=FALSE, paged.print=FALSE}
dt %>% 
  count(M = floor_date(dtprelievo, "week")) %>% 
  mutate(m = rollmean(n, k = 4, fill = NA) )%>%   
  ggplot(aes(M, n))+
  geom_line()+
  geom_line(aes(x=M, y=m), col = "blue", size = 1.5)+
  theme_ipsum_rc()+
  labs(y="n.casi",x="", y = "")+
  aes((dt %>% 
        filter(RV == "P"),  )

```

